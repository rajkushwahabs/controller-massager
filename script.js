(the same fixed robust script.js from previous response)